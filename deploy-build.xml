<?xml version="1.0" encoding="UTF-8"?>
<project name="lantern" default="all" basedir=".">
    <property name="Version" value="1.0-rc1"/>
    <property name="JarFile" value="lanterna-${Version}.jar"/>
    <property name="SourceDeployDirectory" value="lanterna-${Version}"/>
    <property name="SourceFile" value="lanterna-${Version}-source.zip"/>

    <target name="clean">
        <echo message="Cleaning pkg..."/>
        <delete dir="pkg"/>
    </target>

    <target name="init">
        <echo message="Creating pkg..."/>
        <mkdir dir="pkg"/>
        <mkdir dir="dist"/>
    </target>

    <target name="compile" depends="init">
        <echo message="Compiling sources..."/>
        <buildnumber/>
        <echo file="src/org/lantern/BuildInformation.java" append="false">
package org.lantern;
public class BuildInformation
{
    public static final String VERSION = "${Version}";
    public static final int BUILD = ${build.number};
}
        </echo>
        <javac destdir="pkg" debug="false" target="5" encoding="UTF-8" srcdir="src"/>
    </target>

    <target name="build" depends="compile">
        <echo message="Creating .jar file..."/>
        <jar basedir="pkg" jarfile="dist/${JarFile}" compress="true" manifest="deploy-manifest.mf"/>
        
        <echo message="Generating javadoc..."/>
        <javadoc sourcepath="src" destdir="javadoc"/>

        <echo message="Generating the source distribution..."/>
        <mkdir dir="${SourceDeployDirectory}"/>
        <copy todir="${SourceDeployDirectory}">
            <fileset dir="." includes="src/**,javadoc/**"/>
        </copy>
        <zip basedir="lanterna-${Version}" zipfile="dist/${SourceFile}" compress="true" level="9"/>

        <echo message="Cleaning up..."/>
        <delete dir="pkg"/>
        <delete dir="${SourceDeployDirectory}"/>
    </target>

    <target name="all" depends="clean, build"/>
</project>
